{"version":3,"names":["iconv","linewrap","require","createCanvas","Dither","Flatten","EscPosEncoder","constructor","_defineProperty","_reset","_buffer","_codepage","_state","_encode","value","encode","_queue","forEach","item","push","initialize","codepage","codepages","encodingExists","Error","encodings","hanzi","text","wrap","w","lineBreak","bytes","newline","line","undefined","underline","Boolean","Number","italic","bold","size","e","font","scale","align","alignments","barcode","symbology","height","symbologies","length","qrcode","model","errorlevel","models","errorlevels","image","element","width","algorithm","threshold","canvas","context","getContext","drawImage","getImageData","flatten","bayer","floydsteinberg","atkinson","getPixel","x","y","_image$data","data","Uint8Array","i","cut","raw","result","index","set"],"sources":["index.ts"],"sourcesContent":["import iconv from 'iconv-lite';\nconst linewrap = require('linewrap');\nimport {createCanvas, Canvas} from 'canvas';\nconst Dither = require('canvas-dither');\nconst Flatten = require('canvas-flatten');\n\n// Type definitions\ntype Codepage =\n  | 'cp437' | 'cp737' | 'cp850' | 'cp775' | 'cp852' | 'cp855' | 'cp857' | 'cp858'\n  | 'cp860' | 'cp861' | 'cp862' | 'cp863' | 'cp864' | 'cp865' | 'cp866' | 'cp869'\n  | 'cp936' | 'cp949' | 'cp950' | 'cp1252' | 'iso88596' | 'shiftjis' | 'windows874'\n  | 'windows1250' | 'windows1251' | 'windows1252' | 'windows1253' | 'windows1254'\n  | 'windows1255' | 'windows1256' | 'windows1257' | 'windows1258';\n\ntype Alignment = 'left' | 'center' | 'right';\n\ntype Size = 'small' | 'normal' | 'wide' | 'tall' | 'double';\n\ntype Symbology =\n  | 'upca' | 'upce' | 'ean13' | 'ean8' | 'code39' | 'coda39' | 'itf' | 'codabar'\n  | 'code93' | 'code128' | 'gs1-128' | 'gs1-databar-omni' | 'gs1-databar-truncated'\n  | 'gs1-databar-limited' | 'gs1-databar-expanded' | 'code128-auto';\n\ntype ErrorLevel = 'l' | 'm' | 'q' | 'h';\n\ntype CutType = 'full' | 'partial';\n\ntype DitherAlgorithm = 'threshold' | 'bayer' | 'floydsteinberg' | 'atkinson';\n\ninterface PrinterState {\n  bold: boolean;\n  italic: boolean;\n  underline: boolean;\n  hanzi: boolean;\n}\n\n\n/**\n * Create a byte stream based on commands for ESC/POS printers\n */\nexport default class EscPosEncoder {\n  private _buffer!: (number | Uint8Array | Buffer)[];\n  private _codepage!: string;\n  private _state!: PrinterState;\n\n  /**\n   * Create a new object\n   */\n  constructor() {\n    this._reset();\n  }\n\n  /**\n   * Reset the state of the object\n   */\n  private _reset(): void {\n    this._buffer = [];\n    this._codepage = 'ascii';\n\n    this._state = {\n      'bold': false,\n      'italic': false,\n      'underline': false,\n      'hanzi': false,\n    };\n  }\n\n  /**\n   * Encode a string with the current code page\n   *\n   * @param value String to encode\n   * @return Encoded string as a Buffer\n   */\n  private _encode(value: string): Buffer {\n    return iconv.encode(value, this._codepage);\n  }\n\n  /**\n   * Add commands to the buffer\n   *\n   * @param value An array of numbers, arrays, buffers or Uint8Arrays to add to the buffer\n   */\n  private _queue(value: (number | Uint8Array | Buffer)[]): void {\n    value.forEach((item) => this._buffer.push(item));\n  }\n\n  /**\n   * Initialize the printer\n   *\n   * @return Return the object, for easy chaining commands\n   */\n  initialize(): this {\n    this._queue([\n      0x1b, 0x40,\n    ]);\n\n    return this;\n  }\n\n  /**\n   * Change the code page\n   *\n   * @param value The codepage that we set the printer to\n   * @return Return the object, for easy chaining commands\n   */\n  codepage(value: Codepage): this {\n    const codepages: Record<Codepage, [number, boolean]> = {\n      'cp437': [0x00, false],\n      'cp737': [0x40, false],\n      'cp850': [0x02, false],\n      'cp775': [0x5f, false],\n      'cp852': [0x12, false],\n      'cp855': [0x3c, false],\n      'cp857': [0x3d, false],\n      'cp858': [0x13, false],\n      'cp860': [0x03, false],\n      'cp861': [0x38, false],\n      'cp862': [0x3e, false],\n      'cp863': [0x04, false],\n      'cp864': [0x1c, false],\n      'cp865': [0x05, false],\n      'cp866': [0x11, false],\n      'cp869': [0x42, false],\n      'cp936': [0xff, true],\n      'cp949': [0xfd, true],\n      'cp950': [0xfe, true],\n      'cp1252': [0x10, false],\n      'iso88596': [0x16, false],\n      'shiftjis': [0xfc, true],\n      'windows874': [0x1e, false],\n      'windows1250': [0x48, false],\n      'windows1251': [0x49, false],\n      'windows1252': [0x47, false],\n      'windows1253': [0x5a, false],\n      'windows1254': [0x5b, false],\n      'windows1255': [0x20, false],\n      'windows1256': [0x5c, false],\n      'windows1257': [0x19, false],\n      'windows1258': [0x5e, false],\n    };\n\n    let codepage: string;\n\n    if (!iconv.encodingExists(value)) {\n      throw new Error('Unknown codepage');\n    }\n\n    if (value in (iconv as any).encodings) {\n      if (typeof (iconv as any).encodings[value] === 'string') {\n        codepage = (iconv as any).encodings[value];\n      } else {\n        codepage = value;\n      }\n    } else {\n      throw new Error('Unknown codepage');\n    }\n\n    if (typeof codepages[codepage as Codepage] !== 'undefined') {\n      this._codepage = codepage;\n      this._state.hanzi = codepages[codepage as Codepage][1];\n\n      this._queue([\n        0x1b, 0x74, codepages[codepage as Codepage][0],\n      ]);\n    } else {\n      throw new Error('Codepage not supported by printer');\n    }\n\n    return this;\n  }\n\n  /**\n   * Print text\n   *\n   * @param value Text that needs to be printed\n   * @param wrap Wrap text after this many positions\n   * @return Return the object, for easy chaining commands\n   */\n  text(value: string, wrap?: number): this {\n    if (wrap) {\n      const w = linewrap(wrap, {lineBreak: '\\r\\n'});\n      value = w(value);\n    }\n\n    const bytes = this._encode(value);\n\n    if (this._state.hanzi) {\n      this._queue([\n        0x1c, 0x26, bytes, 0x1c, 0x2e,\n      ]);\n    } else {\n      this._queue([\n        bytes,\n      ]);\n    }\n\n    return this;\n  }\n\n  /**\n   * Print a newline\n   *\n   * @return Return the object, for easy chaining commands\n   */\n  newline(): this {\n    this._queue([\n      0x0a, 0x0d,\n    ]);\n\n    return this;\n  }\n\n  /**\n   * Print text, followed by a newline\n   *\n   * @param value Text that needs to be printed\n   * @param wrap Wrap text after this many positions\n   * @return Return the object, for easy chaining commands\n   */\n  line(value?: string, wrap?: number): this {\n    if (value !== undefined) {\n      this.text(value, wrap);\n    }\n    this.newline();\n\n    return this;\n  }\n\n  /**\n   * Underline text\n   *\n   * @param value true to turn on underline, false to turn off, or 2 for double underline\n   * @return Return the object, for easy chaining commands\n   */\n  underline(value?: boolean | number): this {\n    if (typeof value === 'undefined') {\n      value = !this._state.underline;\n    }\n\n    this._state.underline = Boolean(value);\n\n    this._queue([\n      0x1b, 0x2d, Number(value),\n    ]);\n\n    return this;\n  }\n\n  /**\n   * Italic text\n   *\n   * @param value true to turn on italic, false to turn off\n   * @return Return the object, for easy chaining commands\n   */\n  italic(value?: boolean): this {\n    if (typeof value === 'undefined') {\n      value = !this._state.italic;\n    }\n\n    this._state.italic = value;\n\n    this._queue([\n      0x1b, 0x34, Number(value),\n    ]);\n\n    return this;\n  }\n\n  /**\n   * Bold text\n   *\n   * @param value true to turn on bold, false to turn off, or 2 for double underline\n   * @return Return the object, for easy chaining commands\n   */\n  bold(value?: boolean | number): this {\n    if (typeof value === 'undefined') {\n      value = !this._state.bold;\n    }\n\n    this._state.bold = Boolean(value);\n\n    this._queue([\n      0x1b, 0x45, Number(value),\n    ]);\n\n    return this;\n  }\n\n  /**\n   * Change text size\n   *\n   * @param e small, normal, wide, tall, double\n   * @return Return the object, for easy chaining commands\n   */\n  size(e: Size): this {\n    let font = 0; // default: Font A\n    let scale = 0x00; // default: normal size\n\n    switch (e) {\n      case 'small':\n        font = 1; // Font B\n        break;\n      case 'wide':\n        scale = 0x10; // double width\n        break;\n      case 'tall':\n        scale = 0x01; // double height\n        break;\n      case 'double':\n        scale = 0x11; // double width & height\n        break;\n    }\n\n    // Select font\n    this._queue([27, 77, font]);\n    // Apply size scaling\n    this._queue([29, 33, scale]);\n\n    return this;\n  }\n\n  /**\n   * Change text alignment\n   *\n   * @param value left, center or right\n   * @return Return the object, for easy chaining commands\n   */\n  align(value: Alignment): this {\n    const alignments: Record<Alignment, number> = {\n      'left': 0x00,\n      'center': 0x01,\n      'right': 0x02,\n    };\n\n    if (value in alignments) {\n      this._queue([\n        0x1b, 0x61, alignments[value],\n      ]);\n    } else {\n      throw new Error('Unknown alignment');\n    }\n\n    return this;\n  }\n\n  /**\n   * Barcode\n   *\n   * @param value the value of the barcode\n   * @param symbology the type of the barcode\n   * @param height height of the barcode\n   * @return Return the object, for easy chaining commands\n   */\n  barcode(value: string, symbology: Symbology, height: number): this {\n    const symbologies: Record<Symbology, number> = {\n      'upca': 0x00,\n      'upce': 0x01,\n      'ean13': 0x02,\n      'ean8': 0x03,\n      'code39': 0x04,\n      'coda39': 0x04, /* typo, leave here for backwards compatibility */\n      'itf': 0x05,\n      'codabar': 0x06,\n      'code93': 0x48,\n      'code128': 0x49,\n      'gs1-128': 0x50,\n      'gs1-databar-omni': 0x51,\n      'gs1-databar-truncated': 0x52,\n      'gs1-databar-limited': 0x53,\n      'gs1-databar-expanded': 0x54,\n      'code128-auto': 0x55,\n    };\n\n    if (symbology in symbologies) {\n      const bytes = iconv.encode(value, 'ascii');\n\n      this._queue([\n        0x1d, 0x68, height,\n        0x1d, 0x77, symbology === 'code39' ? 0x02 : 0x03,\n      ]);\n\n      if (symbology == 'code128' && bytes[0] !== 0x7b) {\n        /* Not yet encodeded Code 128, assume data is Code B, which is similar to ASCII without control chars */\n\n        this._queue([\n          0x1d, 0x6b, symbologies[symbology],\n          bytes.length + 2,\n          0x7b, 0x42,\n          bytes,\n        ]);\n      } else if (symbologies[symbology] > 0x40) {\n        /* Function B symbologies */\n\n        this._queue([\n          0x1d, 0x6b, symbologies[symbology],\n          bytes.length,\n          bytes,\n        ]);\n      } else {\n        /* Function A symbologies */\n\n        this._queue([\n          0x1d, 0x6b, symbologies[symbology],\n          bytes,\n          0x00,\n        ]);\n      }\n    } else {\n      throw new Error('Symbology not supported by printer');\n    }\n\n    return this;\n  }\n\n  /**\n   * QR code\n   *\n   * @param value the value of the qr code\n   * @param model model of the qrcode, either 1 or 2\n   * @param size size of the qrcode, a value between 1 and 8\n   * @param errorlevel the amount of error correction used, either 'l', 'm', 'q', 'h'\n   * @return Return the object, for easy chaining commands\n   */\n  qrcode(value: string, model?: 1 | 2, size?: number, errorlevel?: ErrorLevel): this {\n    /* Force printing the print buffer and moving to a new line */\n\n    this._queue([\n      0x0a,\n    ]);\n\n    /* Model */\n\n    const models: Record<1 | 2, number> = {\n      1: 0x31,\n      2: 0x32,\n    };\n\n    if (typeof model === 'undefined') {\n      model = 2;\n    }\n\n    if (model in models) {\n      this._queue([\n        0x1d, 0x28, 0x6b, 0x04, 0x00, 0x31, 0x41, models[model], 0x00,\n      ]);\n    } else {\n      throw new Error('Model must be 1 or 2');\n    }\n\n    /* Size */\n\n    if (typeof size === 'undefined') {\n      size = 6;\n    }\n\n    if (typeof size !== 'number') {\n      throw new Error('Size must be a number');\n    }\n\n    if (size < 1 || size > 8) {\n      throw new Error('Size must be between 1 and 8');\n    }\n\n    this._queue([\n      0x1d, 0x28, 0x6b, 0x03, 0x00, 0x31, 0x43, size,\n    ]);\n\n    /* Error level */\n\n    const errorlevels: Record<ErrorLevel, number> = {\n      'l': 0x30,\n      'm': 0x31,\n      'q': 0x32,\n      'h': 0x33,\n    };\n\n    if (typeof errorlevel === 'undefined') {\n      errorlevel = 'm';\n    }\n\n    if (errorlevel in errorlevels) {\n      this._queue([\n        0x1d, 0x28, 0x6b, 0x03, 0x00, 0x31, 0x45, errorlevels[errorlevel],\n      ]);\n    } else {\n      throw new Error('Error level must be l, m, q or h');\n    }\n\n    /* Data */\n\n    const bytes = iconv.encode(value, 'iso88591');\n    const length = bytes.length + 3;\n\n    this._queue([\n      0x1d, 0x28, 0x6b, length % 0xff, length / 0xff, 0x31, 0x50, 0x30, bytes,\n    ]);\n\n    /* Print QR code */\n\n    this._queue([\n      0x1d, 0x28, 0x6b, 0x03, 0x00, 0x31, 0x51, 0x30,\n    ]);\n\n    return this;\n  }\n\n  /**\n   * Image\n   *\n   * @param element an element, like a canvas or image that needs to be printed\n   * @param width width of the image on the printer\n   * @param height height of the image on the printer\n   * @param algorithm the dithering algorithm for making the image black and white\n   * @param threshold threshold for the dithering algorithm\n   * @return Return the object, for easy chaining commands\n   */\n  image(element: Canvas | any, width: number, height: number, algorithm?: DitherAlgorithm, threshold?: number): this {\n    if (width % 8 !== 0) {\n      throw new Error('Width must be a multiple of 8');\n    }\n\n    if (height % 8 !== 0) {\n      throw new Error('Height must be a multiple of 8');\n    }\n\n    if (typeof algorithm === 'undefined') {\n      algorithm = 'threshold';\n    }\n\n    if (typeof threshold === 'undefined') {\n      threshold = 128;\n    }\n\n    const canvas = createCanvas(width, height);\n    const context = canvas.getContext('2d');\n    context.drawImage(element, 0, 0, width, height);\n    let image = context.getImageData(0, 0, width, height);\n\n    image = Flatten.flatten(image, [0xff, 0xff, 0xff]);\n\n    switch (algorithm) {\n      case 'threshold': image = Dither.threshold(image, threshold); break;\n      case 'bayer': image = Dither.bayer(image, threshold); break;\n      case 'floydsteinberg': image = Dither.floydsteinberg(image); break;\n      case 'atkinson': image = Dither.atkinson(image); break;\n    }\n\n    const getPixel = (x: number, y: number): number => (image.data?.[((width * y) + x) * 4] ?? 0) > 0 ? 0 : 1;\n\n    const bytes = new Uint8Array((width * height) >> 3);\n\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x = x + 8) {\n        const i = (y * (width >> 3)) + (x >> 3);\n        bytes[i] =\n                    getPixel(x + 0, y) << 7 |\n                    getPixel(x + 1, y) << 6 |\n                    getPixel(x + 2, y) << 5 |\n                    getPixel(x + 3, y) << 4 |\n                    getPixel(x + 4, y) << 3 |\n                    getPixel(x + 5, y) << 2 |\n                    getPixel(x + 6, y) << 1 |\n                    getPixel(x + 7, y);\n      }\n    }\n\n    this._queue([\n      0x1d, 0x76, 0x30, 0x00,\n      (width >> 3) & 0xff, (((width >> 3) >> 8) & 0xff),\n      height & 0xff, ((height >> 8) & 0xff),\n      bytes,\n    ]);\n\n    return this;\n  }\n\n  /**\n   * Cut paper\n   *\n   * @param value full or partial. When not specified a full cut will be assumed\n   * @return Return the object, for easy chaining commands\n   */\n  cut(value?: CutType): this {\n    let data = 0x00;\n\n    if (value == 'partial') {\n      data = 0x01;\n    }\n\n    this._queue([\n      0x1d, 0x56, data,\n    ]);\n\n    return this;\n  }\n\n  /**\n   * Add raw printer commands\n   *\n   * @param data raw bytes to be included\n   * @return Return the object, for easy chaining commands\n   */\n  raw(data: (number | Uint8Array | Buffer)[]): this {\n    this._queue(data);\n\n    return this;\n  }\n\n  /**\n   * Encode all previous commands\n   *\n   * @return Return the encoded bytes\n   */\n  encode(): Uint8Array {\n    let length = 0;\n\n    this._buffer.forEach((item) => {\n      if (typeof item === 'number') {\n        length++;\n      } else {\n        length += item.length;\n      }\n    });\n\n    const result = new Uint8Array(length);\n\n    let index = 0;\n\n    this._buffer.forEach((item) => {\n      if (typeof item === 'number') {\n        result[index] = item;\n        index++;\n      } else {\n        result.set(item, index);\n        index += item.length;\n      }\n    });\n\n    this._reset();\n\n    return result;\n  }\n}\n\n"],"mappings":"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","ignoreList":[]}